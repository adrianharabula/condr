set serveroutput on;

DROP TABLE USERS CASCADE CONSTRAINTS;
DROP TABLE GROUPS CASCADE CONSTRAINTS;
DROP TABLE USER_GROUPS CASCADE CONSTRAINTS;
DROP TABLE PRODUCTS CASCADE CONSTRAINTS;
DROP TABLE CATEGORY CASCADE CONSTRAINTS;
DROP TABLE CARACTERISTICS CASCADE CONSTRAINTS;
DROP TABLE PRODUCT_CARACTERISTICS CASCADE CONSTRAINTS;
DROP TABLE USER_CARACTERISTICS CASCADE CONSTRAINTS;
DROP TABLE COMPANY CASCADE CONSTRAINTS;

CREATE TABLE USERS
(
  USER_ID NUMBER(10) PRIMARY KEY,
  USERNAME VARCHAR(30) NOT NULL,
  PASSWORD VARCHAR(40) NOT NULL,
  EMAIL VARCHAR(40)
);

CREATE TABLE GROUPS 
(
  GROUP_ID NUMBER(10) PRIMARY KEY,
  NAME VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE USER_GROUPS
(
  RECORD_ID NUMBER(10) PRIMARY KEY,
  USER_ID NUMBER(10) NOT NULL,
  GROUP_ID NUMBER(10) NOT NULL
);

CREATE TABLE CATEGORY
(
  CATEGORY_ID NUMBER(10) PRIMARY KEY,
  NAME VARCHAR(30) UNIQUE NOT NULL,
  DESCRIPTION VARCHAR(100)
);

CREATE TABLE PRODUCTS
(
  PRODUCT_ID NUMBER(10) PRIMARY KEY,
  CATEGORY_ID NUMBER(10) NOT NULL,
  NAME VARCHAR(30) NOT NULL,
  DESCRIPTION VARCHAR(100),
  COMPANY_ID NUMBER(10)
);

CREATE TABLE CARACTERISTICS
(
  CARACTERISTIC_ID NUMBER(10) PRIMARY KEY,
  NAME VARCHAR(30) NOT NULL,
  VALUE VARCHAR(30) NOT NULL
);

CREATE TABLE PRODUCT_CARACTERISTICS
(
  RECORD_ID NUMBER(10) PRIMARY KEY,
  PRODUCT_ID NUMBER(10) NOT NULL,
  CARACTERISTIC_ID NUMBER(10) NOT NULL
);

CREATE TABLE USER_CARACTERISTICS
(
  RECORD_ID NUMBER(10) PRIMARY KEY,
  USER_ID NUMBER(10) NOT NULL,
  CARACTERISTIC_ID NUMBER(10) NOT NULL
);

CREATE TABLE COMPANY
(
  RECORD_ID NUMBER(10) PRIMARY KEY,
  NAME VARCHAR(30) NOT NULL UNIQUE
);
COMMIT;

ALTER TABLE USER_GROUPS ADD CONSTRAINT user_fk FOREIGN KEY(USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE;
ALTER TABLE USER_GROUPS ADD CONSTRAINT group_fk FOREIGN KEY(GROUP_ID) REFERENCES GROUPS(GROUP_ID) ON DELETE CASCADE;
ALTER TABLE PRODUCTS ADD CONSTRAINT category_fk FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORY(CATEGORY_ID) ON DELETE CASCADE;
ALTER TABLE PRODUCT_CARACTERISTICS ADD CONSTRAINT product_fk FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID) ON DELETE CASCADE;
ALTER TABLE PRODUCT_CARACTERISTICS ADD CONSTRAINT caracteristic_fk FOREIGN KEY(CARACTERISTIC_ID) REFERENCES CARACTERISTICS(CARACTERISTIC_ID) ON DELETE CASCADE;
ALTER TABLE USER_CARACTERISTICS ADD CONSTRAINT user_caracteristics_fk FOREIGN KEY(USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE;
ALTER TABLE USER_CARACTERISTICS ADD CONSTRAINT caracteristics_fk FOREIGN KEY(CARACTERISTIC_ID) REFERENCES CARACTERISTICS(CARACTERISTIC_ID) ON DELETE CASCADE;
ALTER TABLE PRODUCTS ADD CONSTRAINT company_fk FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(RECORD_ID) ON DELETE CASCADE;

INSERT INTO CATEGORY VALUES (1,'Electronice','Descriere1');
INSERT INTO CATEGORY VALUES (2,'Imbracaminte','Descriere2');
INSERT INTO CATEGORY VALUES (3,'Incaltaminte','Descriere3');
INSERT INTO CATEGORY VALUES (4,'Mancare','Descriere4');
INSERT INTO CATEGORY VALUES (5,'Entertainment','Descriere5');
INSERT INTO CATEGORY VALUES (6,'Servicii','Descriere5');

INSERT INTO USERS VALUES (1,'ElisaAioanei','parola1','elisa.aioanei@yahoo.com');
INSERT INTO USERS VALUES (2,'ElenaAnghelina','parola2','anghelina.elena@yahoo.com');
INSERT INTO USERS VALUES (3,'MadalinaBuza','parola3','madalina.buza@yahoo.com');
INSERT INTO USERS VALUES (4,'AdrianHarabula','parola4','adrian.harabula@yahoo.com');
INSERT INTO USERS VALUES (5,'otherUser1','parola5','stuff1@info.uaic.ro');
INSERT INTO USERS VALUES (6,'otherUser2','parola5','stuff2@info.uaic.ro');

INSERT INTO GROUPS VALUES (1,'FII');
INSERT INTO GROUPS VALUES (2,'Food Lovers');
INSERT INTO GROUPS VALUES (3,'PSGBD');
INSERT INTO GROUPS VALUES (4,'Web Technologies');

INSERT INTO USER_GROUPS VALUES (1,1,3);
INSERT INTO USER_GROUPS VALUES (2,2,3);
INSERT INTO USER_GROUPS VALUES (3,3,4);
INSERT INTO USER_GROUPS VALUES (4,4,4);

INSERT INTO COMPANY VALUES (1,'Apple');
INSERT INTO COMPANY VALUES (2,'Microsoft');
INSERT INTO COMPANY VALUES (3,'IBM');


COMMIT;

SELECT * FROM CATEGORY;

SELECT * FROM USERS;

SELECT * FROM COMPANY;

set serveroutput on;
DECLARE
v_caracteristic_id  NUMBER(10) := 1 ;
v_name VARCHAR(30) ;
v_value VARCHAR(40);

BEGIN
    WHILE(v_caracteristic_id < 10001)
    LOOP
        v_name := 'caracteristic' || v_caracteristic_id;
        v_value := 'value' || v_caracteristic_id;
        
        INSERT INTO CARACTERISTICS(CARACTERISTIC_ID,NAME,VALUE) VALUES (v_caracteristic_id,v_name,v_value);
        COMMIT;
        v_caracteristic_id := v_caracteristic_id + 1;
    END LOOP;
END;


SELECT * FROM CARACTERISTICS;


set serveroutput on;
DECLARE
v_product_id  NUMBER(10) := 1 ;
v_category_id NUMBER(10) ;
v_name VARCHAR(30);
v_description VARCHAR(100);
v_company_id NUMBER(10);
BEGIN
    WHILE(v_product_id < 10001)
    LOOP
        v_name := 'name' || v_product_id;
        v_description := 'description' || v_product_id;
        SELECT dbms_random.value(1,6) num into v_category_id FROM dual;
        SELECT dbms_random.value(1,3) num into v_company_id FROM dual;
        INSERT INTO PRODUCTS(PRODUCT_ID,CATEGORY_ID,NAME,DESCRIPTION,COMPANY_ID) VALUES (v_product_id,v_category_id,v_name,v_description,v_company_id);
        COMMIT;
        v_product_id := v_product_id + 1;
    END LOOP;
END;


SELECT * FROM PRODUCTS;

INSERT INTO USER_CARACTERISTICS VALUES (1,1,1);
INSERT INTO USER_CARACTERISTICS VALUES (2,1,2);
INSERT INTO USER_CARACTERISTICS VALUES (3,2,1);
INSERT INTO USER_CARACTERISTICS VALUES (4,3,4);

INSERT INTO PRODUCT_CARACTERISTICS VALUES (1,1,2);
INSERT INTO PRODUCT_CARACTERISTICS VALUES (2,4,3);
INSERT INTO PRODUCT_CARACTERISTICS VALUES (3,3,5);
INSERT INTO PRODUCT_CARACTERISTICS VALUES (4,4,1);

COMMIT;

SELECT * FROM USER_CARACTERISTICS;

SELECT * FROM PRODUCT_CARACTERISTICS;

